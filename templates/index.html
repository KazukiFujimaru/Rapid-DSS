{% extends "base.html" %}
{% block body %}

<style>
    /* 1. Agar tabel bisa di-scroll horizontal */
    .table-responsive {
        overflow-x: auto;
        white-space: nowrap; /* Kunci: Mencegah teks turun ke bawah */
    }
    
    /* 2. Agar input memiliki lebar yang layak (tidak gepeng) */
    .table input.form-control {
        min-width: 120px; 
    }
    
    /* 3. Agar header kriteria juga lebar */
    th.group-header input {
        min-width: 120px;
    }

    /* 4. Kolom nomor & tombol hapus yang sempit */
    .col-fixed-sm {
        width: 40px;
        text-align: center;
    }
</style>

<div class="row justify-content-center mb-4">
    <div class="col-md-8 text-center">
        <h3 class="fw-bold text-dark">Data Acquisition</h3>
        <p class="text-muted small">Silakan unggah dataset atau input data matriks keputusan secara manual.</p>
    </div>
</div>

<div class="row g-4">
    <div class="col-md-5">
        <div class="card h-100">
            <div class="card-header py-3">
                <i class="fas fa-file-csv me-2 text-primary"></i>Upload Dataset
            </div>
            <div class="card-body">
                <div class="alert alert-light border small text-muted mb-4">
                    <i class="fas fa-info-circle me-1"></i>
                    Format: <strong>.csv</strong> atau <strong>.xlsx</strong>. <br>
                    Baris pertama harus berisi nama kriteria (Header).
                </div>
                
                <form method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label class="form-label small fw-bold">Pilih File</label>
                        <input class="form-control" type="file" name="file" accept=".csv, .xlsx" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 fw-bold">
                        <i class="fas fa-upload me-2"></i>Upload & Lanjut
                    </button>
                </form>

                {% if error %}
                <div class="alert alert-danger mt-3 small">
                    <i class="fas fa-exclamation-triangle me-1"></i> {{ error }}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-7">
        <div class="card h-100">
            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                <span><i class="fas fa-table me-2 text-primary"></i>Manual Input</span>
                <div>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addColumn()" title="Tambah Kriteria">
                        <i class="fas fa-plus"></i> Col
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="addRow()" title="Tambah Alternatif">
                        <i class="fas fa-plus"></i> Row
                    </button>
                </div>
            </div>
            
            <div class="card-body">
                <form id="formManual" method="POST" action="{{ url_for('index') }}">
                    <input type="hidden" name="manual_data" id="manualDataInput">

                    <div class="table-responsive mb-3 border rounded" style="max-height: 350px;">
                        <table class="table table-sm table-bordered mb-0 align-middle small" id="dynamicTable">
                            <thead class="table-light text-center sticky-top">
                                <tr id="headerRow">
                                    <th class="col-fixed-sm bg-light">#</th>
                                    <th style="min-width: 150px;" class="bg-light">Alternatif</th>
                                    <th class="position-relative group-header bg-light">
                                        <input type="text" class="form-control form-control-sm fw-bold text-center border-0 bg-transparent p-0" value="Kriteria 1">
                                        <button type="button" class="btn btn-link text-danger p-0 position-absolute top-0 end-0 me-1" style="font-size: 0.6rem; text-decoration: none;" onclick="removeColumn(this)">✕</button>
                                    </th>
                                    <th class="position-relative group-header bg-light">
                                        <input type="text" class="form-control form-control-sm fw-bold text-center border-0 bg-transparent p-0" value="Kriteria 2">
                                        <button type="button" class="btn btn-link text-danger p-0 position-absolute top-0 end-0 me-1" style="font-size: 0.6rem; text-decoration: none;" onclick="removeColumn(this)">✕</button>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <tr>
                                    <td class="text-muted text-center">1</td>
                                    <td><input type="text" class="form-control form-control-sm" value="Alternatif A"></td>
                                    <td><input type="number" step="any" class="form-control form-control-sm text-center" placeholder="0"></td>
                                    <td><input type="number" step="any" class="form-control form-control-sm text-center" placeholder="0"></td>
                                    <td class="text-center col-fixed-sm"><button class="btn btn-link text-danger p-0" onclick="removeRow(this)">✕</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="d-grid">
                        <button type="button" class="btn btn-primary fw-bold" onclick="processManualData()">
                            Proses Data <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}